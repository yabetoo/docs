---
title: Coffre-fort d'Ã©pargne
description: Comment intÃ©grer Yabetoo pour les applications d'Ã©pargne par objectifs et de gestion financiÃ¨re comme SafeLock.
icon: "piggy-bank"
---

Apprenez Ã  construire une application de coffre-fort d'Ã©pargne numÃ©rique avec Yabetoo, inspirÃ©e de plateformes comme [SafeLock](https://safelock.website). Ce guide couvre la crÃ©ation de coffres, les dÃ©pÃ´ts, les dÃ©blocages programmÃ©s et le traitement des retraits.

## AperÃ§u

Les plateformes d'Ã©pargne numÃ©riques doivent gÃ©rer :
- Des coffres d'Ã©pargne par objectifs avec pÃ©riodes de blocage
- Les dÃ©pÃ´ts via mobile money
- Les dÃ©blocages automatiques et manuels
- Le traitement des retraits avec frais
- Les calculs d'intÃ©rÃªts ou rÃ©compenses
- La gestion multi-coffres par utilisateur

## Comment fonctionne SafeLock

SafeLock est une application mobile de gestion financiÃ¨re qui aide les utilisateurs Ã  Ã©pargner grÃ¢ce Ã  des "coffres" - des conteneurs d'Ã©pargne verrouillÃ©s liÃ©s Ã  des objectifs personnels avec des dates de dÃ©blocage prÃ©dÃ©finies. FonctionnalitÃ©s clÃ©s :

- **Suivi des objectifs** : Plusieurs coffres pour diffÃ©rents objectifs
- **IntÃ©gration Mobile Money** : Support MTN et Airtel Money
- **DÃ©blocage flexible** : DÃ©blocage auto Ã  maturitÃ© ou retrait anticipÃ© avec frais
- **Support hors ligne** : AccÃ¨s au compte sans internet

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App Mobile    â”‚â”€â”€â”€â”€â–¶â”‚    Yabetoo      â”‚â”€â”€â”€â”€â–¶â”‚  Mobile Money   â”‚
â”‚   (SafeLock)    â”‚â—€â”€â”€â”€â”€â”‚      API        â”‚â—€â”€â”€â”€â”€â”‚   (MTN/Airtel)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Base de       â”‚     â”‚   TÃ¢ches        â”‚
â”‚   donnÃ©es       â”‚     â”‚   planifiÃ©es    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ImplÃ©mentation

### 1. ModÃ¨les de donnÃ©es

DÃ©finissez les structures de coffres et transactions :

```typescript
interface Vault {
  id: string;
  userId: string;
  name: string;
  goal: string;
  targetAmount: number;
  currentAmount: number;
  currency: string;
  unlockDate: Date;
  status: 'active' | 'matured' | 'withdrawn' | 'cancelled';
  autoWithdraw: boolean;
  createdAt: Date;
  unlockedAt?: Date;
  withdrawnAt?: Date;
}

interface VaultTransaction {
  id: string;
  vaultId: string;
  userId: string;
  type: 'deposit' | 'withdrawal' | 'early_withdrawal' | 'interest';
  amount: number;
  fee: number;
  netAmount: number;
  paymentIntentId?: string;
  disbursementId?: string;
  status: 'pending' | 'completed' | 'failed';
  createdAt: Date;
}

// Configuration des frais
const FEES = {
  EARLY_WITHDRAWAL_PERCENT: 3,  // 3% de frais pour retrait anticipÃ©
  MATURITY_WITHDRAWAL_PERCENT: 0, // Pas de frais Ã  maturitÃ©
  MINIMUM_DEPOSIT: 500,  // 500 XAF minimum
  MINIMUM_VAULT_PERIOD_DAYS: 7  // Minimum 7 jours de blocage
};
```

### 2. CrÃ©er un coffre d'Ã©pargne

Permettre aux utilisateurs de crÃ©er des coffres par objectif :

```typescript
import Yabetoo from 'yabetoo';

const yabetoo = new Yabetoo(process.env.YABETOO_SECRET_KEY!);

async function createVault(
  userId: string,
  vaultData: {
    name: string;
    goal: string;
    targetAmount: number;
    unlockDate: Date;
    autoWithdraw: boolean;
    initialDeposit?: number;
  }
) {
  const user = await db.users.findById(userId);

  // Valider la date de dÃ©blocage
  const minUnlockDate = new Date();
  minUnlockDate.setDate(minUnlockDate.getDate() + FEES.MINIMUM_VAULT_PERIOD_DAYS);

  if (vaultData.unlockDate < minUnlockDate) {
    throw new Error(`Le coffre doit Ãªtre bloquÃ© au moins ${FEES.MINIMUM_VAULT_PERIOD_DAYS} jours`);
  }

  // CrÃ©er le coffre
  const vault: Vault = {
    id: generateVaultId(),
    userId,
    name: vaultData.name,
    goal: vaultData.goal,
    targetAmount: vaultData.targetAmount,
    currentAmount: 0,
    currency: 'XAF',
    unlockDate: vaultData.unlockDate,
    status: 'active',
    autoWithdraw: vaultData.autoWithdraw,
    createdAt: new Date()
  };

  await db.vaults.create(vault);

  // GÃ©rer le dÃ©pÃ´t initial si fourni
  let paymentIntent = null;
  if (vaultData.initialDeposit && vaultData.initialDeposit >= FEES.MINIMUM_DEPOSIT) {
    paymentIntent = await createDeposit(vault.id, vaultData.initialDeposit);
  }

  return { vault, paymentIntent };
}
```

### 3. DÃ©pÃ´t sur un coffre

Traiter les dÃ©pÃ´ts via mobile money :

```typescript
async function createDeposit(vaultId: string, amount: number) {
  if (amount < FEES.MINIMUM_DEPOSIT) {
    throw new Error(`DÃ©pÃ´t minimum: ${FEES.MINIMUM_DEPOSIT} XAF`);
  }

  const vault = await db.vaults.findById(vaultId);
  if (vault.status !== 'active') throw new Error('Le coffre n\'est pas actif');

  const user = await db.users.findById(vault.userId);

  // CrÃ©er l'intention de paiement
  const intent = await yabetoo.payments.create({
    amount,
    currency: 'XAF',
    description: `DÃ©pÃ´t vers ${vault.name}`,
    metadata: {
      vaultId,
      userId: vault.userId,
      vaultName: vault.name,
      type: 'vault_deposit'
    }
  });

  // CrÃ©er la transaction en attente
  await db.vaultTransactions.create({
    id: generateTransactionId(),
    vaultId,
    userId: vault.userId,
    type: 'deposit',
    amount,
    fee: 0,
    netAmount: amount,
    paymentIntentId: intent.id,
    status: 'pending',
    createdAt: new Date()
  });

  return intent;
}
```

### 4. Gestionnaire Webhook pour les dÃ©pÃ´ts

Traiter les dÃ©pÃ´ts rÃ©ussis :

```typescript
app.post('/webhooks/yabetoo', async (req, res) => {
  const event = req.body;

  if (event.type === 'payment_intent.succeeded') {
    if (event.data.metadata.type === 'vault_deposit') {
      await handleDepositSuccess(event.data);
    }
  }

  res.json({ received: true });
});

async function handleDepositSuccess(data: any) {
  const { vaultId, userId } = data.metadata;
  const amount = data.amount;

  // Mettre Ã  jour la transaction
  await db.vaultTransactions.updateByPaymentIntent(data.id, {
    status: 'completed'
  });

  // Mettre Ã  jour le solde du coffre
  await db.vaults.incrementAmount(vaultId, amount);

  // Mettre Ã  jour l'Ã©pargne totale de l'utilisateur
  await db.users.incrementTotalSavings(userId, amount);

  const vault = await db.vaults.findById(vaultId);

  // Envoyer notification
  await sendNotification(userId, {
    type: 'deposit_success',
    title: 'DÃ©pÃ´t rÃ©ussi',
    message: `${amount} XAF ajoutÃ©s Ã  votre coffre "${vault.name}". Nouveau solde: ${vault.currentAmount} XAF`,
    vaultId
  });

  // VÃ©rifier si l'objectif est atteint
  if (vault.currentAmount >= vault.targetAmount) {
    await sendNotification(userId, {
      type: 'target_reached',
      title: 'Objectif atteint ! ğŸ‰',
      message: `FÃ©licitations ! Vous avez atteint votre objectif d'Ã©pargne pour "${vault.name}" !`,
      vaultId
    });
  }
}
```

### 5. Traitement de la maturitÃ© des coffres

GÃ©rer les dÃ©blocages quand la date de maturitÃ© est atteinte :

```typescript
// ExÃ©cutÃ© quotidiennement via cron
async function processMaturedVaults() {
  const maturedVaults = await db.vaults.findMany({
    where: {
      status: 'active',
      unlockDate: { lte: new Date() }
    }
  });

  for (const vault of maturedVaults) {
    // Mettre Ã  jour le statut
    await db.vaults.update(vault.id, {
      status: 'matured',
      unlockedAt: new Date()
    });

    // Notifier l'utilisateur
    await sendNotification(vault.userId, {
      type: 'vault_matured',
      title: 'Coffre dÃ©bloquÃ© ! ğŸ”“',
      message: `Votre coffre "${vault.name}" est maintenant dÃ©bloquÃ© ! Vous pouvez retirer ${vault.currentAmount} XAF sans frais.`,
      vaultId: vault.id
    });

    // Traiter le retrait automatique si activÃ©
    if (vault.autoWithdraw && vault.currentAmount > 0) {
      await processWithdrawal(vault.id, vault.currentAmount, false);
    }
  }
}
```

### 6. Traitement des retraits

GÃ©rer les retraits Ã  maturitÃ© et anticipÃ©s :

```typescript
async function processWithdrawal(
  vaultId: string,
  amount: number,
  isEarly: boolean = false
) {
  const vault = await db.vaults.findById(vaultId);
  const user = await db.users.findById(vault.userId);

  if (amount > vault.currentAmount) {
    throw new Error('Solde insuffisant dans le coffre');
  }

  // VÃ©rifier si retrait anticipÃ©
  if (vault.status === 'active' && new Date() < vault.unlockDate) {
    isEarly = true;
  }

  // Calculer les frais
  const feePercent = isEarly
    ? FEES.EARLY_WITHDRAWAL_PERCENT
    : FEES.MATURITY_WITHDRAWAL_PERCENT;
  const fee = Math.round(amount * (feePercent / 100));
  const netAmount = amount - fee;

  // CrÃ©er la transaction de retrait
  const transaction = {
    id: generateTransactionId(),
    vaultId,
    userId: vault.userId,
    type: isEarly ? 'early_withdrawal' : 'withdrawal',
    amount,
    fee,
    netAmount,
    status: 'pending',
    createdAt: new Date()
  };

  await db.vaultTransactions.create(transaction);

  // Traiter le dÃ©caissement
  const disbursement = await yabetoo.disbursements.create({
    amount: netAmount,
    currency: 'XAF',
    firstName: user.firstName,
    lastName: user.lastName,
    paymentMethodData: {
      type: 'momo',
      momo: {
        msisdn: user.phone,
        country: 'cg',
        operatorName: user.operatorName
      }
    }
  });

  // Mettre Ã  jour le coffre
  await db.vaults.update(vaultId, {
    currentAmount: vault.currentAmount - amount,
    status: vault.currentAmount - amount === 0 ? 'withdrawn' : vault.status
  });

  return { transaction, disbursement, fee, netAmount };
}
```

### 7. Statistiques du tableau de bord

Fournir aux utilisateurs des insights sur leur Ã©pargne :

```typescript
async function getUserDashboard(userId: string) {
  const user = await db.users.findById(userId);
  const vaults = await db.vaults.findByUser(userId);
  const transactions = await db.vaultTransactions.findByUser(userId);

  const activeVaults = vaults.filter(v => v.status === 'active');

  // Progression vers les objectifs
  const vaultProgress = activeVaults.map(vault => ({
    vaultId: vault.id,
    name: vault.name,
    goal: vault.goal,
    currentAmount: vault.currentAmount,
    targetAmount: vault.targetAmount,
    progressPercent: Math.round((vault.currentAmount / vault.targetAmount) * 100),
    daysUntilUnlock: Math.ceil(
      (vault.unlockDate.getTime() - Date.now()) / (1000 * 60 * 60 * 24)
    )
  }));

  return {
    summary: {
      totalSavings: user.totalSavings,
      activeVaults: activeVaults.length,
      totalDeposits: transactions.filter(t => t.type === 'deposit' && t.status === 'completed').reduce((s, t) => s + t.amount, 0)
    },
    vaultProgress,
    recentTransactions: transactions.slice(0, 10)
  };
}
```

## Flux utilisateur

<Steps>
  <Step title="CrÃ©er un compte">
    L'utilisateur s'inscrit avec son numÃ©ro de tÃ©lÃ©phone (MTN ou Airtel).
  </Step>
  <Step title="CrÃ©er un coffre">
    L'utilisateur crÃ©e un coffre d'Ã©pargne avec un objectif, un montant cible et une date de dÃ©blocage.
  </Step>
  <Step title="Effectuer des dÃ©pÃ´ts">
    L'utilisateur dÃ©pose de l'argent via mobile money Ã  tout moment.
  </Step>
  <Step title="Suivre la progression">
    L'utilisateur surveille sa progression vers ses objectifs dans l'app.
  </Step>
  <Step title="MaturitÃ© du coffre">
    Quand la date de dÃ©blocage arrive, le coffre devient disponible pour retrait.
  </Step>
  <Step title="Retirer">
    L'utilisateur retire les fonds vers son compte mobile money.
  </Step>
</Steps>

## Structure des frais

| Action | Frais |
|--------|-------|
| DÃ©pÃ´t | Gratuit |
| Retrait Ã  maturitÃ© | Gratuit |
| Retrait anticipÃ© | 3% |
| Maintenance compte | Gratuit |

## Bonnes pratiques

<AccordionGroup>
  <Accordion title="DÃ©fis d'Ã©pargne">
    CrÃ©ez des dÃ©fis hebdomadaires ou mensuels pour encourager les dÃ©pÃ´ts rÃ©guliers.
  </Accordion>
  <Accordion title="FonctionnalitÃ©s sociales">
    Permettez aux utilisateurs de partager leur progression (anonymement) pour crÃ©er de la responsabilitÃ©.
  </Accordion>
  <Accordion title="Objectifs flexibles">
    Laissez les utilisateurs ajuster les montants cibles et les dates si les circonstances changent.
  </Accordion>
  <Accordion title="IntÃ©rÃªts/RÃ©compenses">
    Envisagez d'offrir de petites rÃ©compenses pour les objectifs atteints Ã  temps.
  </Accordion>
</AccordionGroup>

## ModÃ¨les de notifications

```typescript
const NOTIFICATION_TEMPLATES = {
  deposit_success: (amount: number, vaultName: string, balance: number) =>
    `âœ… ${amount} XAF dÃ©posÃ©s dans "${vaultName}". Solde: ${balance} XAF`,

  vault_matured: (vaultName: string, amount: number) =>
    `ğŸ”“ Votre coffre "${vaultName}" est dÃ©bloquÃ© ! Retirez ${amount} XAF sans frais.`,

  target_reached: (vaultName: string) =>
    `ğŸ‰ Objectif atteint pour "${vaultName}" ! Continuez ou attendez le dÃ©blocage.`,

  savings_reminder: (vaultName: string, remaining: number, days: number) =>
    `ğŸ’° "${vaultName}" a besoin de ${remaining} XAF dans ${days} jours. DÃ©posez maintenant !`
};
```

## Ressources associÃ©es

<CardGroup cols={2}>
  <Card title="Intentions de paiement" icon="credit-card" href="/fr/payments/api/overview">
    Apprenez Ã  traiter les dÃ©pÃ´ts
  </Card>
  <Card title="DÃ©caissements" icon="money-bill-transfer" href="/fr/payments/disbursement/overview">
    GÃ©rer les retraits vers les utilisateurs
  </Card>
</CardGroup>
