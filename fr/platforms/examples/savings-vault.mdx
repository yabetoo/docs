---
title: Coffre-fort d'√©pargne
description: Comment int√©grer Yabetoo pour les applications d'√©pargne par objectifs et de gestion financi√®re comme SafeLock.
icon: "piggy-bank"
---

Apprenez √† construire une application de coffre-fort d'√©pargne num√©rique avec Yabetoo, inspir√©e de plateformes comme [SafeLock](https://safelock.website). Ce guide couvre la cr√©ation de coffres, les d√©p√¥ts, les d√©blocages programm√©s et le traitement des retraits.

## Aper√ßu

Les plateformes d'√©pargne num√©riques doivent g√©rer :
- Des coffres d'√©pargne par objectifs avec p√©riodes de blocage
- Les d√©p√¥ts via mobile money
- Les d√©blocages automatiques et manuels
- Le traitement des retraits avec frais
- Les calculs d'int√©r√™ts ou r√©compenses
- La gestion multi-coffres par utilisateur

## Comment fonctionne SafeLock

SafeLock est une application mobile de gestion financi√®re qui aide les utilisateurs √† √©pargner gr√¢ce √† des "coffres" - des conteneurs d'√©pargne verrouill√©s li√©s √† des objectifs personnels avec des dates de d√©blocage pr√©d√©finies. Fonctionnalit√©s cl√©s :

- **Suivi des objectifs** : Plusieurs coffres pour diff√©rents objectifs
- **Int√©gration Mobile Money** : Support MTN et Airtel Money
- **D√©blocage flexible** : D√©blocage auto √† maturit√© ou retrait anticip√© avec frais
- **Support hors ligne** : Acc√®s au compte sans internet

## Architecture

```mermaid
flowchart LR
    A[App √âpargne] --> B[Yabetoo API]
    B --> C[Mobile Money]
    C --> B
    B --> A
```

## Impl√©mentation

### 1. Mod√®les de donn√©es

D√©finissez les structures de coffres et transactions :

```typescript
interface Vault {
  id: string;
  userId: string;
  name: string;
  goal: string;
  targetAmount: number;
  currentAmount: number;
  currency: string;
  unlockDate: Date;
  status: 'active' | 'matured' | 'withdrawn' | 'cancelled';
  autoWithdraw: boolean;
  createdAt: Date;
  unlockedAt?: Date;
  withdrawnAt?: Date;
}

interface VaultTransaction {
  id: string;
  vaultId: string;
  userId: string;
  type: 'deposit' | 'withdrawal' | 'early_withdrawal' | 'interest';
  amount: number;
  fee: number;
  netAmount: number;
  paymentIntentId?: string;
  disbursementId?: string;
  status: 'pending' | 'completed' | 'failed';
  createdAt: Date;
}

// Configuration des frais
const FEES = {
  EARLY_WITHDRAWAL_PERCENT: 3,  // 3% de frais pour retrait anticip√©
  MATURITY_WITHDRAWAL_PERCENT: 0, // Pas de frais √† maturit√©
  MINIMUM_DEPOSIT: 500,  // 500 XAF minimum
  MINIMUM_VAULT_PERIOD_DAYS: 7  // Minimum 7 jours de blocage
};
```

### 2. Cr√©er un coffre d'√©pargne

Permettre aux utilisateurs de cr√©er des coffres par objectif :

```typescript
import Yabetoo from 'yabetoo';

const yabetoo = new Yabetoo(process.env.YABETOO_SECRET_KEY!);

async function createVault(
  userId: string,
  vaultData: {
    name: string;
    goal: string;
    targetAmount: number;
    unlockDate: Date;
    autoWithdraw: boolean;
    initialDeposit?: number;
  }
) {
  const user = await db.users.findById(userId);

  // Valider la date de d√©blocage
  const minUnlockDate = new Date();
  minUnlockDate.setDate(minUnlockDate.getDate() + FEES.MINIMUM_VAULT_PERIOD_DAYS);

  if (vaultData.unlockDate < minUnlockDate) {
    throw new Error(`Le coffre doit √™tre bloqu√© au moins ${FEES.MINIMUM_VAULT_PERIOD_DAYS} jours`);
  }

  // Cr√©er le coffre
  const vault: Vault = {
    id: generateVaultId(),
    userId,
    name: vaultData.name,
    goal: vaultData.goal,
    targetAmount: vaultData.targetAmount,
    currentAmount: 0,
    currency: 'XAF',
    unlockDate: vaultData.unlockDate,
    status: 'active',
    autoWithdraw: vaultData.autoWithdraw,
    createdAt: new Date()
  };

  await db.vaults.create(vault);

  // G√©rer le d√©p√¥t initial si fourni
  let paymentIntent = null;
  if (vaultData.initialDeposit && vaultData.initialDeposit >= FEES.MINIMUM_DEPOSIT) {
    paymentIntent = await createDeposit(vault.id, vaultData.initialDeposit);
  }

  return { vault, paymentIntent };
}
```

### 3. D√©p√¥t sur un coffre

Traiter les d√©p√¥ts via mobile money :

```typescript
async function createDeposit(vaultId: string, amount: number) {
  if (amount < FEES.MINIMUM_DEPOSIT) {
    throw new Error(`D√©p√¥t minimum: ${FEES.MINIMUM_DEPOSIT} XAF`);
  }

  const vault = await db.vaults.findById(vaultId);
  if (vault.status !== 'active') throw new Error('Le coffre n\'est pas actif');

  const user = await db.users.findById(vault.userId);

  // Cr√©er l'intention de paiement
  const intent = await yabetoo.payments.create({
    amount,
    currency: 'XAF',
    description: `D√©p√¥t vers ${vault.name}`,
    metadata: {
      vaultId,
      userId: vault.userId,
      vaultName: vault.name,
      type: 'vault_deposit'
    }
  });

  // Cr√©er la transaction en attente
  await db.vaultTransactions.create({
    id: generateTransactionId(),
    vaultId,
    userId: vault.userId,
    type: 'deposit',
    amount,
    fee: 0,
    netAmount: amount,
    paymentIntentId: intent.id,
    status: 'pending',
    createdAt: new Date()
  });

  return intent;
}
```

### 4. Gestionnaire Webhook pour les d√©p√¥ts

Traiter les d√©p√¥ts r√©ussis :

```typescript
app.post('/webhooks/yabetoo', async (req, res) => {
  const event = req.body;

  if (event.type === 'payment_intent.succeeded') {
    if (event.data.metadata.type === 'vault_deposit') {
      await handleDepositSuccess(event.data);
    }
  }

  res.json({ received: true });
});

async function handleDepositSuccess(data: any) {
  const { vaultId, userId } = data.metadata;
  const amount = data.amount;

  // Mettre √† jour la transaction
  await db.vaultTransactions.updateByPaymentIntent(data.id, {
    status: 'completed'
  });

  // Mettre √† jour le solde du coffre
  await db.vaults.incrementAmount(vaultId, amount);

  // Mettre √† jour l'√©pargne totale de l'utilisateur
  await db.users.incrementTotalSavings(userId, amount);

  const vault = await db.vaults.findById(vaultId);

  // Envoyer notification
  await sendNotification(userId, {
    type: 'deposit_success',
    title: 'D√©p√¥t r√©ussi',
    message: `${amount} XAF ajout√©s √† votre coffre "${vault.name}". Nouveau solde: ${vault.currentAmount} XAF`,
    vaultId
  });

  // V√©rifier si l'objectif est atteint
  if (vault.currentAmount >= vault.targetAmount) {
    await sendNotification(userId, {
      type: 'target_reached',
      title: 'Objectif atteint ! üéâ',
      message: `F√©licitations ! Vous avez atteint votre objectif d'√©pargne pour "${vault.name}" !`,
      vaultId
    });
  }
}
```

### 5. Traitement de la maturit√© des coffres

G√©rer les d√©blocages quand la date de maturit√© est atteinte :

```typescript
// Ex√©cut√© quotidiennement via cron
async function processMaturedVaults() {
  const maturedVaults = await db.vaults.findMany({
    where: {
      status: 'active',
      unlockDate: { lte: new Date() }
    }
  });

  for (const vault of maturedVaults) {
    // Mettre √† jour le statut
    await db.vaults.update(vault.id, {
      status: 'matured',
      unlockedAt: new Date()
    });

    // Notifier l'utilisateur
    await sendNotification(vault.userId, {
      type: 'vault_matured',
      title: 'Coffre d√©bloqu√© ! üîì',
      message: `Votre coffre "${vault.name}" est maintenant d√©bloqu√© ! Vous pouvez retirer ${vault.currentAmount} XAF sans frais.`,
      vaultId: vault.id
    });

    // Traiter le retrait automatique si activ√©
    if (vault.autoWithdraw && vault.currentAmount > 0) {
      await processWithdrawal(vault.id, vault.currentAmount, false);
    }
  }
}
```

### 6. Traitement des retraits

G√©rer les retraits √† maturit√© et anticip√©s :

```typescript
async function processWithdrawal(
  vaultId: string,
  amount: number,
  isEarly: boolean = false
) {
  const vault = await db.vaults.findById(vaultId);
  const user = await db.users.findById(vault.userId);

  if (amount > vault.currentAmount) {
    throw new Error('Solde insuffisant dans le coffre');
  }

  // V√©rifier si retrait anticip√©
  if (vault.status === 'active' && new Date() < vault.unlockDate) {
    isEarly = true;
  }

  // Calculer les frais
  const feePercent = isEarly
    ? FEES.EARLY_WITHDRAWAL_PERCENT
    : FEES.MATURITY_WITHDRAWAL_PERCENT;
  const fee = Math.round(amount * (feePercent / 100));
  const netAmount = amount - fee;

  // Cr√©er la transaction de retrait
  const transaction = {
    id: generateTransactionId(),
    vaultId,
    userId: vault.userId,
    type: isEarly ? 'early_withdrawal' : 'withdrawal',
    amount,
    fee,
    netAmount,
    status: 'pending',
    createdAt: new Date()
  };

  await db.vaultTransactions.create(transaction);

  // Traiter le d√©caissement
  const disbursement = await yabetoo.disbursements.create({
    amount: netAmount,
    currency: 'XAF',
    firstName: user.firstName,
    lastName: user.lastName,
    paymentMethodData: {
      type: 'momo',
      momo: {
        msisdn: user.phone,
        country: 'cg',
        operatorName: user.operatorName
      }
    }
  });

  // Mettre √† jour le coffre
  await db.vaults.update(vaultId, {
    currentAmount: vault.currentAmount - amount,
    status: vault.currentAmount - amount === 0 ? 'withdrawn' : vault.status
  });

  return { transaction, disbursement, fee, netAmount };
}
```

### 7. Statistiques du tableau de bord

Fournir aux utilisateurs des insights sur leur √©pargne :

```typescript
async function getUserDashboard(userId: string) {
  const user = await db.users.findById(userId);
  const vaults = await db.vaults.findByUser(userId);
  const transactions = await db.vaultTransactions.findByUser(userId);

  const activeVaults = vaults.filter(v => v.status === 'active');

  // Progression vers les objectifs
  const vaultProgress = activeVaults.map(vault => ({
    vaultId: vault.id,
    name: vault.name,
    goal: vault.goal,
    currentAmount: vault.currentAmount,
    targetAmount: vault.targetAmount,
    progressPercent: Math.round((vault.currentAmount / vault.targetAmount) * 100),
    daysUntilUnlock: Math.ceil(
      (vault.unlockDate.getTime() - Date.now()) / (1000 * 60 * 60 * 24)
    )
  }));

  return {
    summary: {
      totalSavings: user.totalSavings,
      activeVaults: activeVaults.length,
      totalDeposits: transactions.filter(t => t.type === 'deposit' && t.status === 'completed').reduce((s, t) => s + t.amount, 0)
    },
    vaultProgress,
    recentTransactions: transactions.slice(0, 10)
  };
}
```

## Flux utilisateur

<Steps>
  <Step title="Cr√©er un compte">
    L'utilisateur s'inscrit avec son num√©ro de t√©l√©phone (MTN ou Airtel).
  </Step>
  <Step title="Cr√©er un coffre">
    L'utilisateur cr√©e un coffre d'√©pargne avec un objectif, un montant cible et une date de d√©blocage.
  </Step>
  <Step title="Effectuer des d√©p√¥ts">
    L'utilisateur d√©pose de l'argent via mobile money √† tout moment.
  </Step>
  <Step title="Suivre la progression">
    L'utilisateur surveille sa progression vers ses objectifs dans l'app.
  </Step>
  <Step title="Maturit√© du coffre">
    Quand la date de d√©blocage arrive, le coffre devient disponible pour retrait.
  </Step>
  <Step title="Retirer">
    L'utilisateur retire les fonds vers son compte mobile money.
  </Step>
</Steps>

## Structure des frais

| Action | Frais |
|--------|-------|
| D√©p√¥t | Gratuit |
| Retrait √† maturit√© | Gratuit |
| Retrait anticip√© | 3% |
| Maintenance compte | Gratuit |

## Bonnes pratiques

<AccordionGroup>
  <Accordion title="D√©fis d'√©pargne">
    Cr√©ez des d√©fis hebdomadaires ou mensuels pour encourager les d√©p√¥ts r√©guliers.
  </Accordion>
  <Accordion title="Fonctionnalit√©s sociales">
    Permettez aux utilisateurs de partager leur progression (anonymement) pour cr√©er de la responsabilit√©.
  </Accordion>
  <Accordion title="Objectifs flexibles">
    Laissez les utilisateurs ajuster les montants cibles et les dates si les circonstances changent.
  </Accordion>
  <Accordion title="Int√©r√™ts/R√©compenses">
    Envisagez d'offrir de petites r√©compenses pour les objectifs atteints √† temps.
  </Accordion>
</AccordionGroup>

## Mod√®les de notifications

```typescript
const NOTIFICATION_TEMPLATES = {
  deposit_success: (amount: number, vaultName: string, balance: number) =>
    `‚úÖ ${amount} XAF d√©pos√©s dans "${vaultName}". Solde: ${balance} XAF`,

  vault_matured: (vaultName: string, amount: number) =>
    `üîì Votre coffre "${vaultName}" est d√©bloqu√© ! Retirez ${amount} XAF sans frais.`,

  target_reached: (vaultName: string) =>
    `üéâ Objectif atteint pour "${vaultName}" ! Continuez ou attendez le d√©blocage.`,

  savings_reminder: (vaultName: string, remaining: number, days: number) =>
    `üí∞ "${vaultName}" a besoin de ${remaining} XAF dans ${days} jours. D√©posez maintenant !`
};
```

## Ressources associ√©es

<CardGroup cols={2}>
  <Card title="Intentions de paiement" icon="credit-card" href="/fr/payments/api/overview">
    Apprenez √† traiter les d√©p√¥ts
  </Card>
  <Card title="D√©caissements" icon="money-bill-transfer" href="/fr/payments/disbursement/overview">
    G√©rer les retraits vers les utilisateurs
  </Card>
</CardGroup>
